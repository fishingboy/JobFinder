{"version":3,"sources":["jobFinder.js","urlParams.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"jobFinderMain.js","sourcesContent":["var JOBFINDER = JOBFINDER || {};\n\nJOBFINDER.namespace = function(ns_string) {\n\tvar parts = ns_string.split('.'),\n\t\tparent = JOBFINDER,\n\t\ti;\n\t// strip redundant leading global\n\tif (parts[0] === \"JOBFINDER\") {\n\t\tparts = parts.slice(1);\n\t}\n\tfor (i = 0; i < parts.length; i += 1) {\n\t\t// create a property if it doesn't exist\n\t\tif (typeof parent[parts[i]] === \"undefined\") {\n\t\t\tparent[parts[i]] = {};\n\t\t}\n\t\tparent = parent[parts[i]];\n\t}\n\treturn parent;\n};\n\nvar jobList = JOBFINDER.namespace(\"JOBFINDER.jobList\");\nvar companyList = JOBFINDER.namespace(\"JOBFINDER.companyList\");\nvar pagination = JOBFINDER.namespace(\"JOBFINDER.pagination\");\n\n/*\n * 取得工作資訊\n */\nJOBFINDER.listJobs = function(options, renderView) {\n\tvar settings = $.extend({\n\t\tapiUrl: '/job/',\n\t\tpage: 1,\n\t\tpage_size: 50,\n\t\torderby: {\n\t\t\tsal_month_high: 'DESC',\n\t\t\tsal_month_low: 'DESC'\n\t\t}\n\t}, options || {});\n\n\tvar sendData = {\n\t\tpage: settings.page,\n\t\tpage_size: settings.page_size,\n\t\torderby: settings.orderby\n\t};\n\n\t// console.log(sendData);\n\n\t$.ajax({\n\t\turl: settings.apiUrl,\n\t\tmethod: \"GET\",\n\t\tdataType: \"JSON\",\n\t\tdata: sendData\n\t}).done(function(res) {\n\t\t// console.log(res);\n\t\tif (res.status === true) {\n\t\t\t$(\"#jobListBody\").empty();\n\n\t\t\tvar stateData = History.getState();\n\t\t\t/*如果是進入首頁 網址列無參數 預設塞入第一頁的pushState值*/\n\t\t\tif (!stateData.data) {\n\t\t\t\tHistory.pushState({\n\t\t\t\t\tstate: page\n\t\t\t\t}, \"Page\" + page, \"?page=\" + page); // logs {state:1}, \"State 1\", \"?state=1\"\n\t\t\t}\n\n\t\t\trenderView(res);\n\n\t\t\tJOBFINDER.currentPage = res.curr_page;\n\t\t\tJOBFINDER.total_page = res.total_page;\n\t\t\tvar pagerArgs = {\n\t\t\t\tminPage: 1,\n\t\t\t\tcurrentPage: res.curr_page,\n\t\t\t\trangeScope: 4,\n\t\t\t\ttotalPage: JOBFINDER.total_page\n\t\t\t};\n\t\t\tpagination.createPager(pagerArgs);\n\t\t\twindow.scrollTo(0, 0);\n\t\t} else {\n\t\t\talert(\"取得資料失敗\");\n\t\t}\n\t});\n};\n\n/*render 工作列表*/\nJOBFINDER.jobList.renderView = function(data) {\n\tvar source = $(\"#jobListTmpl\").html();\n\tvar template = Handlebars.compile(source);\n\tvar rendered = template(data);\n\t$(\"#jobListBody\").append(rendered);\n};\n\nJOBFINDER.companyList.renderView = function(data) {\n\tvar source = $(\"#jobListTmpl\").html();\n\t// console.log(source);\n\tvar template = Handlebars.compile(source);\n\tvar rendered = template(data);\n\t$(\"#jobListBody\").append(rendered);\n\t$('.job-detail').hide();\n\t//\n\t// // show/hide job detail\n\t$(\".toggle-detail\").each(function() {\n\t\t$(this).click(function() {\n\t\t\t$(\"tr[name='\" + $(this).data('name') + \"']\").toggle();\n\t\t});\n\t});\n};\n\n/*建立分頁元素*/\nJOBFINDER.pagination.createPager = function(options) {\n\t// var settings = options || {};\n\tvar settings = $.extend({\n\t\tpagination: [],\n\n\t}, options || {});\n\tvar pageRange = pagination.pageRangeCalculate(settings);\n\n\tfor (var page = pageRange.start; page <= pageRange.end; page++) {\n\t\tsettings.pagination.push(page);\n\t}\n\tconsole.log(settings);\n\t$('#pagerBody').empty();\n\tvar source = $(\"#pagerTmpl\").html();\n\tvar template = Handlebars.compile(source);\n\tvar rendered = template(settings);\n\t$('#pagerBody').append(rendered);\n\n};\n\n/* 計算分頁範圍 */\nJOBFINDER.pagination.pageRangeCalculate = function(options) {\n\tvar settings = $.extend({\n\t\t\tcurrentPage: 1,\n\t\t\tminPage: 1,\n\t\t\ttotalPage: 20,\n\t\t\trangeScope: 2\n\t\t}, options || {}),\n\t\tstartPage = settings.currentPage,\n\t\tendPage = settings.totalPage;\n\n\tif (settings.currentPage - settings.rangeScope <= 0) {\n\t\tendPage = settings.minPage + (settings.rangeScope * 2);\n\t\tstartPage = settings.minPage;\n\t} else if ((settings.currentPage + settings.rangeScope) >= settings.totalPage) {\n\t\tstartPage = settings.totalPage - (settings.rangeScope * 2);\n\t} else {\n\t\tstartPage = settings.currentPage - settings.rangeScope;\n\t\tendPage = settings.currentPage + settings.rangeScope;\n\t}\n\t// console.log(startPage);\n\treturn {\n\t\tstart: startPage,\n\t\tend: endPage\n\t};\n};\n\n/*重新刷新工作列表內容*/\nJOBFINDER.pagination.refreshPage = function(options, renderView) {\n\tvar urlParams = JOBFINDER.getUrlParams();\n\tvar orderby = {};\n\n\tif (options.apiUrl === \"/job/\") {\n\t\torderby = JOBFINDER.getOrderBy();\n\t} else {\n\t\torderby = JOBFINDER.companyList.getOrderBy();\n\t}\n\n\tvar settings = {\n\t\tapiUrl: options.apiUrl,\n\t\tpage_size: options.page_size,\n\t\tpage: urlParams.page,\n\t\torderby: orderby\n\t};\n\n\tJOBFINDER.listJobs(settings, renderView);\n};\n\nJOBFINDER.pagination.getNextPage = function() {\n\t// e.preventDefault();\n\tvar urlParams = getUrlParams();\n\tvar page = urlParams.page || 1;\n\tif (page >= JOBFINDER.total_page) {\n\t\tpage = JOBFINDER.total_page;\n\t} else {\n\t\tpage++;\n\t}\n\tconsole.log(JOBFINDER.total_page);\n\tconsole.log(page);\n\treturn page;\n};\n\nJOBFINDER.pagination.getPrevPage = function() {\n\tvar urlParams = getUrlParams();\n\tvar page = urlParams.page || 1;\n\tif (page - 1 <= 0) {\n\t\tpage = 1;\n\t} else {\n\t\tpage--;\n\t}\n\treturn page;\n};\n\n/* Handlebars helper 判斷分頁元素是否為當前頁面  顯示為highlight*/\nHandlebars.registerHelper('isActive', function(context, options) {\n\tif (context === options.data.root.currentPage) {\n\t\treturn options.fn(this);\n\t} else {\n\t\treturn options.inverse(this);\n\t}\n});\n\n//監聽並觸發 popstate 動作\nJOBFINDER.jobList.onstatechange = function(options, renderView) {\n\twindow.onstatechange = function() {\n\t\tJOBFINDER.pagination.refreshPage(options, renderView);\n\t};\n};\n\n/* 綁定排序EVENT */\nJOBFINDER.bindOrder = function() {\n\t$('#btnSortCompany, #btnSortSalary').click(function() {\n\t\tvar urlParams = JOBFINDER.getUrlParams();\n\t\tvar iElement = $(this).find('i').eq(0);\n\t\tvar btnId = $(this).attr(\"id\");\n\n\t\tvar pushStateData = {\n\t\t\tpage: urlParams.page\n\t\t};\n\n\t\t/*change sort button class*/\n\t\tswitch (btnId) {\n\t\t\tcase 'btnSortSalary':\n\t\t\t\tpushStateData.salarySort = JOBFINDER.toggleSort(urlParams.salarySort);\n\t\t\t\tJOBFINDER.changeBtnSortClass(iElement, pushStateData.salarySort);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tJOBFINDER.pushState(pushStateData);\n\t});\n};\n\nJOBFINDER.pushState = function(options) {\n\tvar urlParams = JOBFINDER.getUrlParams();\n\tvar qs = \"\";\n\tqs = \"?page=\" + options.page;\n\tvar salarySort = options.salarySort || urlParams.salarySort || \"DESC\";\n\tqs += \"&salarySort=\" + salarySort;\n\t// if (typeof options.salarySort !== \"undefined\") {}\n\tHistory.pushState({\n\t\tstate: options.page\n\t}, \"JobFinder\", qs);\n};\n\nJOBFINDER.companyList.pushState = function(options) {\n\tvar urlParams = JOBFINDER.companyList.getUrlParams();\n\tvar page = options.page || urlParams.page || 1;\n\tvar qs = \"\";\n\tqs = \"?page=\" + page;\n\n\tvar capitalSort = options.capitalSort || urlParams.capitalSort || \"DESC\";\n\tqs += \"&capitalSort=\" + capitalSort;\n\n\tHistory.pushState({\n\t\tstate: options.page\n\t}, \"JobFinder\", qs);\n};\n\n/* 取得網址列參數並做處理(job) */\nJOBFINDER.getUrlParams = function() {\n\tvar urlParams = window.getUrlParams();\n\tvar result = urlParams;\n\tresult.page = urlParams.page || 1;\n\tresult.salarySort = urlParams.salarySort || \"DESC\";\n\treturn result;\n};\n\n/* 取得參數並整理為orderby參數處理(job) */\nJOBFINDER.getOrderBy = function() {\n\tvar urlParams = JOBFINDER.getUrlParams();\n\tvar orderby = {};\n\torderby.sal_month_high = urlParams.salarySort;\n\torderby.sal_month_low = urlParams.salarySort;\n\treturn orderby;\n};\n\n/* 取得網址列參數並做處理(company) */\nJOBFINDER.companyList.getUrlParams = function() {\n\tvar urlParams = window.getUrlParams();\n\tvar result = urlParams;\n\tresult.page = urlParams.page || 1;\n\tresult.capitalSort = urlParams.capitalSort || \"DESC\";\n\treturn result;\n};\n\n/* 取得參數並整理為orderby參數處理(company) */\nJOBFINDER.companyList.getOrderBy = function() {\n\tvar urlParams = JOBFINDER.getUrlParams();\n\tvar orderby = {};\n\torderby.capital = urlParams.capitalSort;\n\treturn orderby;\n};\n\nJOBFINDER.changeBtnSortClass = function(obj, sort) {\n\tif (sort === \"DESC\") {\n\t\tobj.addClass(\"fa-chevron-down\");\n\t\tobj.removeClass(\"fa-chevron-up\");\n\t} else {\n\t\tobj.addClass(\"fa-chevron-up\");\n\t\tobj.removeClass(\"fa-chevron-down\");\n\t}\n};\n\nJOBFINDER.toggleSort = function(sort) {\n\treturn sort === \"DESC\" ? \"ASC\" : \"DESC\";\n};\n","var getUrlParams = function() {\r\n\tvar match,\r\n\t\tpl = /\\+/g, // Regex for replacing addition symbol with a space\r\n\t\tsearch = /([^&=]+)=?([^&]*)/g,\r\n\t\tdecode = function(s) {\r\n\t\t\treturn decodeURIComponent(s.replace(pl, \" \"));\r\n\t\t},\r\n\t\tquery = window.location.search.substring(1),\r\n\t\turlParams = {};\r\n\r\n\twhile ((match = search.exec(query)) !== null)\r\n\t\turlParams[decode(match[1])] = decode(match[2]);\r\n\t// console.log(urlParams);\r\n\treturn urlParams;\r\n};\r\n"],"sourceRoot":"/source/"}