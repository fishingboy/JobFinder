{"version":3,"sources":["jobFinder.js","urlParams.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"jobFinderMain.js","sourcesContent":["var JOBFINDER = JOBFINDER || {};\r\n\r\nJOBFINDER.namespace = function(ns_string) {\r\n\tvar parts = ns_string.split('.'),\r\n\t\tparent = JOBFINDER,\r\n\t\ti;\r\n\t// strip redundant leading global\r\n\tif (parts[0] === \"JOBFINDER\") {\r\n\t\tparts = parts.slice(1);\r\n\t}\r\n\tfor (i = 0; i < parts.length; i += 1) {\r\n\t\t// create a property if it doesn't exist\r\n\t\tif (typeof parent[parts[i]] === \"undefined\") {\r\n\t\t\tparent[parts[i]] = {};\r\n\t\t}\r\n\t\tparent = parent[parts[i]];\r\n\t}\r\n\treturn parent;\r\n};\r\n\r\nvar jobList = JOBFINDER.namespace(\"JOBFINDER.jobList\");\r\nvar companyList = JOBFINDER.namespace(\"JOBFINDER.companyList\");\r\nvar pagination = JOBFINDER.namespace(\"JOBFINDER.pagination\");\r\n\r\n/*\r\n * 取得工作資訊\r\n */\r\nJOBFINDER.listJobs = function(options, renderView) {\r\n\tvar settings = $.extend({\r\n\t\tapiUrl: '/job/',\r\n\t\tpage: 1,\r\n\t\tpage_size: 50,\r\n\t\torderby: {\r\n\t\t\tsal_month_high: 'DESC',\r\n\t\t\tsal_month_low: 'DESC'\r\n\t\t}\r\n\t}, options || {});\r\n\r\n\tvar sendData = {\r\n\t\tpage: settings.page,\r\n\t\tpage_size: settings.page_size,\r\n\t\torderby: settings.orderby\r\n\t};\r\n\r\n\t// console.log(sendData);\r\n\r\n\t$.ajax({\r\n\t\turl: settings.apiUrl,\r\n\t\tmethod: \"GET\",\r\n\t\tdataType: \"JSON\",\r\n\t\tdata: sendData\r\n\t}).done(function(res) {\r\n\t\t// console.log(res);\r\n\t\tif (res.status === true) {\r\n\t\t\t$(\"#jobListBody\").empty();\r\n\r\n\t\t\tvar stateData = History.getState();\r\n\t\t\t/*如果是進入首頁 網址列無參數 預設塞入第一頁的pushState值*/\r\n\t\t\tif (!stateData.data) {\r\n\t\t\t\tHistory.pushState({\r\n\t\t\t\t\tstate: page\r\n\t\t\t\t}, \"Page\" + page, \"?page=\" + page); // logs {state:1}, \"State 1\", \"?state=1\"\r\n\t\t\t}\r\n\r\n\t\t\trenderView(res);\r\n\r\n\t\t\tJOBFINDER.currentPage = res.curr_page;\r\n\t\t\tJOBFINDER.total_page = res.total_page;\r\n\t\t\tvar pagerArgs = {\r\n\t\t\t\tminPage: 1,\r\n\t\t\t\tcurrentPage: res.curr_page,\r\n\t\t\t\trangeScope: 4,\r\n\t\t\t\ttotalPage: JOBFINDER.total_page\r\n\t\t\t};\r\n\t\t\tpagination.createPager(pagerArgs);\r\n\t\t\twindow.scrollTo(0, 0);\r\n\t\t} else {\r\n\t\t\talert(\"取得資料失敗\");\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/*render 工作列表*/\r\nJOBFINDER.jobList.renderView = function(data) {\r\n\tvar source = $(\"#jobListTmpl\").html();\r\n\tvar template = Handlebars.compile(source);\r\n\tvar rendered = template(data);\r\n\t$(\"#jobListBody\").append(rendered);\r\n};\r\n\r\nJOBFINDER.companyList.renderView = function(data) {\r\n\tvar source = $(\"#jobListTmpl\").html();\r\n\t// console.log(source);\r\n\tvar template = Handlebars.compile(source);\r\n\tvar rendered = template(data);\r\n\t$(\"#jobListBody\").append(rendered);\r\n\t$('.job-detail').hide();\r\n\t//\r\n\t// // show/hide job detail\r\n\t$(\".toggle-detail\").each(function() {\r\n\t\t$(this).click(function() {\r\n\t\t\t$(\"tr[name='\" + $(this).data('name') + \"']\").toggle();\r\n\t\t});\r\n\t});\r\n};\r\n\r\n/*建立分頁元素*/\r\nJOBFINDER.pagination.createPager = function(options) {\r\n\t// var settings = options || {};\r\n\tvar settings = $.extend({\r\n\t\tpagination: [],\r\n\r\n\t}, options || {});\r\n\tvar pageRange = pagination.pageRangeCalculate(settings);\r\n\r\n\tfor (var page = pageRange.start; page <= pageRange.end; page++) {\r\n\t\tsettings.pagination.push(page);\r\n\t}\r\n\tconsole.log(settings);\r\n\t$('#pagerBody').empty();\r\n\tvar source = $(\"#pagerTmpl\").html();\r\n\tvar template = Handlebars.compile(source);\r\n\tvar rendered = template(settings);\r\n\t$('#pagerBody').append(rendered);\r\n\r\n};\r\n\r\n/* 計算分頁範圍 */\r\nJOBFINDER.pagination.pageRangeCalculate = function(options) {\r\n\tvar settings = $.extend({\r\n\t\t\tcurrentPage: 1,\r\n\t\t\tminPage: 1,\r\n\t\t\ttotalPage: 20,\r\n\t\t\trangeScope: 2\r\n\t\t}, options || {}),\r\n\t\tstartPage = settings.currentPage,\r\n\t\tendPage = settings.totalPage;\r\n\r\n\tif (settings.currentPage - settings.rangeScope <= 0) {\r\n\t\tendPage = settings.minPage + (settings.rangeScope * 2);\r\n\t\tstartPage = settings.minPage;\r\n\t} else if ((settings.currentPage + settings.rangeScope) >= settings.totalPage) {\r\n\t\tstartPage = settings.totalPage - (settings.rangeScope * 2);\r\n\t} else {\r\n\t\tstartPage = settings.currentPage - settings.rangeScope;\r\n\t\tendPage = settings.currentPage + settings.rangeScope;\r\n\t}\r\n\t// console.log(startPage);\r\n\treturn {\r\n\t\tstart: startPage,\r\n\t\tend: endPage\r\n\t};\r\n};\r\n\r\n/*重新刷新工作列表內容*/\r\nJOBFINDER.pagination.refreshPage = function(options, renderView) {\r\n\tvar urlParams = JOBFINDER.getUrlParams();\r\n\tvar orderby = {};\r\n\r\n\tif (options.apiUrl === \"/job/\") {\r\n\t\torderby = JOBFINDER.getOrderBy();\r\n\t} else {\r\n\t\torderby = JOBFINDER.companyList.getOrderBy();\r\n\t}\r\n\r\n\tvar settings = {\r\n\t\tapiUrl: options.apiUrl,\r\n\t\tpage_size: options.page_size,\r\n\t\tpage: urlParams.page,\r\n\t\torderby: orderby\r\n\t};\r\n\r\n\tJOBFINDER.listJobs(settings, renderView);\r\n};\r\n\r\nJOBFINDER.pagination.getNextPage = function() {\r\n\t// e.preventDefault();\r\n\tvar urlParams = getUrlParams();\r\n\tvar page = urlParams.page || 1;\r\n\tif (page >= JOBFINDER.total_page) {\r\n\t\tpage = JOBFINDER.total_page;\r\n\t} else {\r\n\t\tpage++;\r\n\t}\r\n\tconsole.log(JOBFINDER.total_page);\r\n\tconsole.log(page);\r\n\treturn page;\r\n};\r\n\r\nJOBFINDER.pagination.getPrevPage = function() {\r\n\tvar urlParams = getUrlParams();\r\n\tvar page = urlParams.page || 1;\r\n\tif (page - 1 <= 0) {\r\n\t\tpage = 1;\r\n\t} else {\r\n\t\tpage--;\r\n\t}\r\n\treturn page;\r\n};\r\n\r\n/* Handlebars helper 判斷分頁元素是否為當前頁面  顯示為highlight*/\r\nHandlebars.registerHelper('isActive', function(context, options) {\r\n\tif (context === options.data.root.currentPage) {\r\n\t\treturn options.fn(this);\r\n\t} else {\r\n\t\treturn options.inverse(this);\r\n\t}\r\n});\r\n\r\n//監聽並觸發 popstate 動作\r\nJOBFINDER.jobList.onstatechange = function(options, renderView) {\r\n\twindow.onstatechange = function() {\r\n\t\tJOBFINDER.pagination.refreshPage(options, renderView);\r\n\t};\r\n};\r\n\r\n/* 綁定排序EVENT */\r\nJOBFINDER.bindOrder = function() {\r\n\t$('#btnSortCompany, #btnSortSalary').click(function() {\r\n\t\tvar urlParams = JOBFINDER.getUrlParams();\r\n\t\tvar iElement = $(this).find('i').eq(0);\r\n\t\tvar btnId = $(this).attr(\"id\");\r\n\r\n\t\tvar pushStateData = {\r\n\t\t\tpage: urlParams.page\r\n\t\t};\r\n\r\n\t\t/*change sort button class*/\r\n\t\tswitch (btnId) {\r\n\t\t\tcase 'btnSortSalary':\r\n\t\t\t\tpushStateData.salarySort = JOBFINDER.toggleSort(urlParams.salarySort);\r\n\t\t\t\tJOBFINDER.changeBtnSortClass(iElement, pushStateData.salarySort);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tJOBFINDER.pushState(pushStateData);\r\n\t});\r\n};\r\n\r\nJOBFINDER.pushState = function(options) {\r\n\tvar urlParams = JOBFINDER.getUrlParams();\r\n\tvar qs = \"\";\r\n\tqs = \"?page=\" + options.page;\r\n\tvar salarySort = options.salarySort || urlParams.salarySort || \"DESC\";\r\n\tqs += \"&salarySort=\" + salarySort;\r\n\t// if (typeof options.salarySort !== \"undefined\") {}\r\n\tHistory.pushState({\r\n\t\tstate: options.page\r\n\t}, \"JobFinder\", qs);\r\n};\r\n\r\nJOBFINDER.companyList.pushState = function(options) {\r\n\tvar urlParams = JOBFINDER.companyList.getUrlParams();\r\n\tvar page = options.page || urlParams.page || 1;\r\n\tvar qs = \"\";\r\n\tqs = \"?page=\" + page;\r\n\r\n\tvar capitalSort = options.capitalSort || urlParams.capitalSort || \"DESC\";\r\n\tqs += \"&capitalSort=\" + capitalSort;\r\n\r\n\tHistory.pushState({\r\n\t\tstate: options.page\r\n\t}, \"JobFinder\", qs);\r\n};\r\n\r\n/* 取得網址列參數並做處理(job) */\r\nJOBFINDER.getUrlParams = function() {\r\n\tvar urlParams = window.getUrlParams();\r\n\tvar result = urlParams;\r\n\tresult.page = urlParams.page || 1;\r\n\tresult.salarySort = urlParams.salarySort || \"DESC\";\r\n\treturn result;\r\n};\r\n\r\n/* 取得參數並整理為orderby參數處理(job) */\r\nJOBFINDER.getOrderBy = function() {\r\n\tvar urlParams = JOBFINDER.getUrlParams();\r\n\tvar orderby = {};\r\n\torderby.sal_month_high = urlParams.salarySort;\r\n\torderby.sal_month_low = urlParams.salarySort;\r\n\treturn orderby;\r\n};\r\n\r\n/* 取得網址列參數並做處理(company) */\r\nJOBFINDER.companyList.getUrlParams = function() {\r\n\tvar urlParams = window.getUrlParams();\r\n\tvar result = urlParams;\r\n\tresult.page = urlParams.page || 1;\r\n\tresult.capitalSort = urlParams.capitalSort || \"DESC\";\r\n\treturn result;\r\n};\r\n\r\n/* 取得參數並整理為orderby參數處理(company) */\r\nJOBFINDER.companyList.getOrderBy = function() {\r\n\tvar urlParams = JOBFINDER.getUrlParams();\r\n\tvar orderby = {};\r\n\torderby.capital = urlParams.capitalSort;\r\n\treturn orderby;\r\n};\r\n\r\nJOBFINDER.changeBtnSortClass = function(obj, sort) {\r\n\tif (sort === \"DESC\") {\r\n\t\tobj.addClass(\"fa-chevron-down\");\r\n\t\tobj.removeClass(\"fa-chevron-up\");\r\n\t} else {\r\n\t\tobj.addClass(\"fa-chevron-up\");\r\n\t\tobj.removeClass(\"fa-chevron-down\");\r\n\t}\r\n};\r\n\r\nJOBFINDER.toggleSort = function(sort) {\r\n\treturn sort === \"DESC\" ? \"ASC\" : \"DESC\";\r\n};\r\n","var getUrlParams = function() {\r\n\tvar match,\r\n\t\tpl = /\\+/g, // Regex for replacing addition symbol with a space\r\n\t\tsearch = /([^&=]+)=?([^&]*)/g,\r\n\t\tdecode = function(s) {\r\n\t\t\treturn decodeURIComponent(s.replace(pl, \" \"));\r\n\t\t},\r\n\t\tquery = window.location.search.substring(1),\r\n\t\turlParams = {};\r\n\r\n\twhile ((match = search.exec(query)) !== null)\r\n\t\turlParams[decode(match[1])] = decode(match[2]);\r\n\t// console.log(urlParams);\r\n\treturn urlParams;\r\n};\r\n"],"sourceRoot":"/source/"}