var JOBFINDER=JOBFINDER||{};JOBFINDER.namespace=function(a){var e,t=a.split("."),r=JOBFINDER;for("JOBFINDER"===t[0]&&(t=t.slice(1)),e=0;e<t.length;e+=1)"undefined"==typeof r[t[e]]&&(r[t[e]]={}),r=r[t[e]];return r};var jobList=JOBFINDER.namespace("JOBFINDER.jobList"),companyList=JOBFINDER.namespace("JOBFINDER.companyList"),pagination=JOBFINDER.namespace("JOBFINDER.pagination");JOBFINDER.listJobs=function(a,e){var t=$.extend({apiUrl:"/job/",page:1,page_size:50,orderby:{sal_month_high:"DESC",sal_month_low:"DESC"}},a||{}),r={page:t.page,page_size:t.page_size,orderby:t.orderby};$.ajax({url:t.apiUrl,method:"GET",dataType:"JSON",data:r}).done(function(a){if(a.status===!0){$("#jobListBody").empty();var t=History.getState();t.data||History.pushState({state:page},"Page"+page,"?page="+page),e(a),JOBFINDER.currentPage=a.curr_page,JOBFINDER.total_page=a.total_page;var r={minPage:1,currentPage:a.curr_page,rangeScope:2};pagination.createPager(r),window.scrollTo(0,0)}else alert("取得資料失敗")})},JOBFINDER.jobList.renderView=function(a){var e=$("#jobListTmpl").html(),t=Handlebars.compile(e),r=t(a);$("#jobListBody").append(r)},JOBFINDER.companyList.renderView=function(a){var e=$("#jobListTmpl").html(),t=Handlebars.compile(e),r=t(a);$("#jobListBody").append(r),$(".job-detail").hide(),$(".toggle-detail").each(function(){$(this).click(function(){$("tr[name='"+$(this).data("name")+"']").toggle()})})},JOBFINDER.pagination.createPager=function(a){for(var e=$.extend({pagination:[]},a||{}),t=pagination.pageRangeCalculate(e),r=t.start;r<=t.end;r++)e.pagination.push(r);$("#pagerBody").empty();var n=$("#pagerTmpl").html(),o=Handlebars.compile(n),i=o(e);$("#pagerBody").append(i)},JOBFINDER.pagination.pageRangeCalculate=function(a){var e=$.extend({currentPage:1,minPage:1,totalPage:20,rangeScope:2},a||{}),t=e.currentPage,r=e.totalPage;return e.currentPage-e.rangeScope<=0?(r=e.minPage+2*e.rangeScope,t=e.minPage):e.currentPage+e.rangeScope>=e.totalPage?t=e.totalPage-2*e.rangeScope:(t=e.currentPage-e.rangeScope,r=e.currentPage+e.rangeScope),{start:t,end:r}},JOBFINDER.pagination.refreshPage=function(a,e){var t=JOBFINDER.getUrlParams(),r={};r="/job/"===a.apiUrl?JOBFINDER.getOrderBy():JOBFINDER.companyList.getOrderBy();var n={apiUrl:a.apiUrl,page_size:a.page_size,page:t.page,orderby:r};JOBFINDER.listJobs(n,e)},JOBFINDER.pagination.getNextPage=function(){var a=getUrlParams(),e=a.page||1;return e>=JOBFINDER.totalPage?e=JOBFINDER.totalPage:e++,e},JOBFINDER.pagination.getPrevPage=function(){var a=getUrlParams(),e=a.page||1;return 0>=e-1?e=1:e--,e},Handlebars.registerHelper("isActive",function(a,e){return a===e.data.root.currentPage?e.fn(this):e.inverse(this)}),JOBFINDER.jobList.onstatechange=function(a,e){window.onstatechange=function(){JOBFINDER.pagination.refreshPage(a,e)}},JOBFINDER.bindOrder=function(){$("#btnSortCompany, #btnSortSalary").click(function(){var a=JOBFINDER.getUrlParams(),e=$(this).find("i").eq(0),t=$(this).attr("id"),r={page:a.page};switch(t){case"btnSortSalary":r.salarySort=JOBFINDER.toggleSort(a.salarySort),JOBFINDER.changeBtnSortClass(e,r.salarySort)}JOBFINDER.pushState(r)})},JOBFINDER.pushState=function(a){var e=JOBFINDER.getUrlParams(),t="";t="?page="+a.page;var r=a.salarySort||e.salarySort||"DESC";t+="&salarySort="+r,History.pushState({state:a.page},"JobFinder",t)},JOBFINDER.companyList.pushState=function(a){var e=JOBFINDER.companyList.getUrlParams(),t=a.page||e.page||1,r="";r="?page="+t;var n=a.capitalSort||e.capitalSort||"DESC";r+="&capitalSort="+n,History.pushState({state:a.page},"JobFinder",r)},JOBFINDER.getUrlParams=function(){var a=window.getUrlParams(),e=a;return e.page=a.page||1,e.salarySort=a.salarySort||"DESC",e},JOBFINDER.getOrderBy=function(){var a=JOBFINDER.getUrlParams(),e={};return e.sal_month_high=a.salarySort,e.sal_month_low=a.salarySort,e},JOBFINDER.companyList.getUrlParams=function(){var a=window.getUrlParams(),e=a;return e.page=a.page||1,e.capitalSort=a.capitalSort||"DESC",e},JOBFINDER.companyList.getOrderBy=function(){var a=JOBFINDER.getUrlParams(),e={};return e.capital=a.capitalSort,e},JOBFINDER.changeBtnSortClass=function(a,e){"DESC"===e?(a.addClass("fa-chevron-down"),a.removeClass("fa-chevron-up")):(a.addClass("fa-chevron-up"),a.removeClass("fa-chevron-down"))},JOBFINDER.toggleSort=function(a){return"DESC"===a?"ASC":"DESC"};var getUrlParams=function(){var a,e=/\+/g,t=/([^&=]+)=?([^&]*)/g,r=function(a){return decodeURIComponent(a.replace(e," "))},n=window.location.search.substring(1);for(urlParams={};null!==(a=t.exec(n));)urlParams[r(a[1])]=r(a[2]);return urlParams};